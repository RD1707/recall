<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sessão de estudo interativa com flashcards - Recall">
    <meta name="theme-color" content="#4f46e5">
    <title>Sessão de Estudo - Recall</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/study.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="preload" href="js/study.js" as="script">
</head>

<body class="study-page" data-theme="light" data-font-size="medium">

    <header class="study-header" role="banner">
        <div class="header-container">
            <div class="header-left">
                <button id="back-btn" class="icon-btn ghost" aria-label="Voltar ao baralho">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="deck-info">
                    <h1 id="deck-title" class="deck-title">Carregando...</h1>
                    <div class="deck-meta">
                        <span class="meta-item">
                            <i class="fas fa-layer-group"></i>
                            <span id="total-cards">0</span> cards
                        </span>
                        <span class="meta-separator">•</span>
                        <span class="meta-item">
                            <i class="fas fa-fire"></i>
                            <span id="streak-count">0</span> dias
                        </span>
                    </div>
                </div>
            </div>

            <div class="header-center">
                <div class="study-timer">
                    <i class="fas fa-clock"></i>
                    <time id="timer" datetime="00:00">00:00</time>
                </div>
            </div>

            <div class="header-right">
                <div class="header-actions">
                    <div class="study-mode-toggle" role="radiogroup" aria-label="Modo de estudo">
                        <button class="mode-btn active" data-mode="normal" aria-checked="true">
                            <i class="fas fa-graduation-cap"></i>
                            <span class="mode-label">Normal</span>
                        </button>
                        <button class="mode-btn" data-mode="speed" aria-checked="false">
                            <i class="fas fa-bolt"></i>
                            <span class="mode-label">Rápido</span>
                        </button>
                        <button class="mode-btn" data-mode="hard" aria-checked="false">
                            <i class="fas fa-brain"></i>
                            <span class="mode-label">Difícil</span>
                        </button>
                    </div>

                    <button id="shortcuts-btn" class="icon-btn" aria-label="Atalhos de teclado">
                        <i class="fas fa-keyboard"></i>
                    </button>
                    <button id="settings-btn" class="icon-btn" aria-label="Configurações">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="fullscreen-btn" class="icon-btn" aria-label="Tela cheia">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="global-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-track">
                <div id="global-progress-fill" class="progress-fill"></div>
            </div>
            <div class="progress-info">
                <span class="progress-text">
                    <span id="current-card">0</span> / <span id="total-review">0</span>
                </span>
                <div class="progress-stats">
                    <span class="stat success">
                        <i class="fas fa-check-circle"></i>
                        <span id="correct-count">0</span>
                    </span>
                    <span class="stat warning">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="hard-count">0</span>
                    </span>
                    <span class="stat danger">
                        <i class="fas fa-times-circle"></i>
                        <span id="wrong-count">0</span>
                    </span>
                </div>
            </div>
        </div>
    </header>

    <main class="study-main" role="main">

        <div id="loading-state" class="state-container loading-state" aria-live="polite">
            <div class="state-content">
                <div class="loading-animation">
                    <div class="loading-spinner"></div>
                    <div class="loading-progress">
                        <div class="progress-ring">
                            <svg width="120" height="120">
                                <circle cx="60" cy="60" r="54" stroke-width="8" />
                            </svg>
                        </div>
                    </div>
                </div>
                <h2>Preparando sua sessão</h2>
                <p id="loading-message">Carregando flashcards...</p>
            </div>
        </div>

        <div id="study-container" class="study-container hidden">

            <div class="study-top-bar">
                <div class="card-indicators">
                    <button class="indicator-dot" data-card="0" aria-label="Card 1"></button>
                </div>
                <div class="quick-actions">
                    <button id="bookmark-btn" class="action-btn" aria-label="Marcar card">
                        <i class="far fa-bookmark"></i>
                    </button>
                    <button id="flag-btn" class="action-btn" aria-label="Sinalizar para revisão">
                        <i class="far fa-flag"></i>
                    </button>
                    <button id="notes-btn" class="action-btn" aria-label="Adicionar nota">
                        <i class="far fa-sticky-note"></i>
                    </button>
                </div>
            </div>

            <div class="card-stage">
                <div class="card-preview prev" id="prev-preview">
                    <div class="preview-content">
                        <p class="preview-text"></p>
                    </div>
                </div>

                <div class="main-card-container">
                    <div class="flip-card" id="flip-card" role="region" aria-live="polite">
                        <div class="flip-card-inner">
                            <article class="card-face card-front">
                                <div class="card-header">
                                    <div class="card-type">
                                        <i class="fas fa-question-circle"></i>
                                        <span>Pergunta</span>
                                    </div>
                                    <div class="card-difficulty" data-level="medium">
                                        <span class="difficulty-indicator"></span>
                                        <span class="difficulty-label">Médio</span>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <div class="card-content-wrapper">
                                        <p id="card-question" class="card-content"></p>
                                    </div>

                                    <div id="hint-section" class="hint-section hidden">
                                        <div class="hint-toggle">
                                            <button id="show-hint" class="hint-btn">
                                                <i class="fas fa-lightbulb"></i>
                                                Mostrar dica
                                            </button>
                                        </div>
                                        <div id="hint-content" class="hint-content hidden"></div>
                                    </div>
                                </div>

                                <div class="card-footer">
                                    <div class="card-tags">
                                    </div>
                                    <div class="card-prompt">
                                        <kbd>Espaço</kbd> para revelar resposta
                                    </div>
                                </div>
                            </article>

                            <article class="card-face card-back">
                                <div class="card-header">
                                    <div class="card-type">
                                        <i class="fas fa-check-circle"></i>
                                        <span>Resposta</span>
                                    </div>
                                    <button id="report-btn" class="report-btn" aria-label="Reportar problema">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </button>
                                </div>

                                <div class="card-body">
                                    <div class="card-content-wrapper">
                                        <p id="card-answer" class="card-content"></p>
                                    </div>

                                    <div id="explanation-section" class="explanation-section hidden">
                                        <h3>
                                            <i class="fas fa-info-circle"></i>
                                            Explicação
                                        </h3>
                                        <div id="explanation-content"></div>
                                    </div>

                                    <div id="references-section" class="references-section hidden">
                                        <h4>Referências</h4>
                                        <ul id="references-list"></ul>
                                    </div>
                                </div>

                                <div class="card-footer">
                                    <p class="quality-prompt">Como foi seu desempenho?</p>
                                </div>
                            </article>
                        </div>

                        <div id="feedback-overlay" class="feedback-overlay">
                            <div class="feedback-content">
                                <div class="feedback-icon"></div>
                                <div class="feedback-text"></div>
                                <div class="feedback-subtitle"></div>
                            </div>
                        </div>
                    </div>

                    <nav class="card-navigation" aria-label="Navegação entre cards">
                        <button id="prev-card" class="nav-btn prev" disabled aria-label="Card anterior">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="next-card" class="nav-btn next" disabled aria-label="Próximo card">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>

                <div class="card-preview next" id="next-preview">
                    <div class="preview-content">
                        <p class="preview-text"></p>
                    </div>
                </div>
            </div>

            <div class="response-controls">
                <button id="flip-btn" class="btn btn-primary btn-large flip-btn">
                    <i class="fas fa-sync-alt"></i>
                    <span>Revelar Resposta</span>
                    <kbd>Espaço</kbd>
                </button>

                <div id="quality-buttons" class="quality-buttons hidden">
                    <div class="quality-grid">
                        <button class="quality-btn" data-quality="1" data-feedback="again">
                            <div class="quality-icon">
                                <i class="fas fa-redo"></i>
                            </div>
                            <div class="quality-info">
                                <span class="quality-label">Errei</span>
                                <span class="quality-time">&lt; 1 min</span>
                            </div>
                            <kbd>1</kbd>
                        </button>

                        <button class="quality-btn" data-quality="2" data-feedback="hard">
                            <div class="quality-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="quality-info">
                                <span class="quality-label">Difícil</span>
                                <span class="quality-time">~6 min</span>
                            </div>
                            <kbd>2</kbd>
                        </button>

                        <button class="quality-btn" data-quality="3" data-feedback="good">
                            <div class="quality-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="quality-info">
                                <span class="quality-label">Bom</span>
                                <span class="quality-time">~10 min</span>
                            </div>
                            <kbd>3</kbd>
                        </button>

                        <button class="quality-btn" data-quality="4" data-feedback="easy">
                            <div class="quality-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="quality-info">
                                <span class="quality-label">Fácil</span>
                                <span class="quality-time">~4 dias</span>
                            </div>
                            <kbd>4</kbd>
                        </button>
                    </div>
                </div>
            </div>

            <div class="live-stats">
                <div class="stat-card">
                    <i class="fas fa-tachometer-alt"></i>
                    <div class="stat-info">
                        <span class="stat-value" id="cards-per-minute">0</span>
                        <span class="stat-label">cards/min</span>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-percentage"></i>
                    <div class="stat-info">
                        <span class="stat-value" id="accuracy-rate">0%</span>
                        <span class="stat-label">precisão</span>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-brain"></i>
                    <div class="stat-info">
                        <span class="stat-value" id="retention-score">0</span>
                        <span class="stat-label">retenção</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="completion-container" class="state-container completion-state hidden">
            <div class="completion-content">
                <div class="celebration-animation">
                    <div class="confetti-container"></div>
                    <div class="trophy-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                </div>

                <div class="completion-header">
                    <h1 id="completion-title">Sessão Concluída!</h1>
                    <p id="completion-subtitle">Você está no caminho certo para dominar este conteúdo</p>
                </div>

                <div class="session-stats">
                    <div class="stats-grid">
                        <div class="stat-block">
                            <div class="stat-icon success">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-number" id="final-time">00:00</span>
                                <span class="stat-description">Tempo total</span>
                            </div>
                        </div>

                        <div class="stat-block">
                            <div class="stat-icon primary">
                                <i class="fas fa-layer-group"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-number" id="final-cards">0</span>
                                <span class="stat-description">Cards revisados</span>
                            </div>
                        </div>

                        <div class="stat-block">
                            <div class="stat-icon warning">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-number" id="final-speed">0</span>
                                <span class="stat-description">Cards/minuto</span>
                            </div>
                        </div>

                        <div class="stat-block">
                            <div class="stat-icon success">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-number" id="final-accuracy">0%</span>
                                <span class="stat-description">Taxa de acerto</span>
                            </div>
                        </div>
                    </div>

                    <div class="performance-chart">
                        <h3>Distribuição de Respostas</h3>
                        <div class="chart-container">
                            <canvas id="performance-chart"></canvas>
                        </div>
                    </div>

                    <div id="achievements" class="achievements-section hidden">
                        <h3>Conquistas Desbloqueadas</h3>
                        <div class="achievements-grid">
                        </div>
                    </div>

                    <div class="insights-section">
                        <h3>Insights da Sessão</h3>
                        <div class="insights-list">
                        </div>
                    </div>
                </div>

                <div class="completion-actions">
                    <button id="review-mistakes" class="btn btn-outline">
                        <i class="fas fa-redo"></i>
                        Revisar Erros
                    </button>
                    <button id="continue-studying" class="btn btn-primary">
                        <i class="fas fa-play"></i>
                        Continuar Estudando
                    </button>
                    <a href="dashboard.html" class="btn btn-secondary">
                        <i class="fas fa-home"></i>
                        Voltar ao Dashboard
                    </a>
                </div>

                <div class="next-session-info">
                    <p>Próxima revisão em: <strong id="next-review-time">2 horas</strong></p>
                    <button id="set-reminder" class="btn btn-text">
                        <i class="fas fa-bell"></i>
                        Definir lembrete
                    </button>
                </div>
            </div>
        </div>
    </main>

    <dialog id="shortcuts-modal" class="modal" aria-labelledby="shortcuts-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="shortcuts-title">Atalhos de Teclado</h2>
                <button class="modal-close" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-item">
                        <kbd>Espaço</kbd>
                        <span>Virar card / Próximo card</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>←</kbd> <kbd>→</kbd>
                        <span>Navegar entre cards</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd> <kbd>4</kbd>
                        <span>Avaliar resposta</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>H</kbd>
                        <span>Mostrar/ocultar dica</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>B</kbd>
                        <span>Marcar/desmarcar favorito</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>F</kbd>
                        <span>Sinalizar para revisão</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>N</kbd>
                        <span>Adicionar nota</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd>
                        <span>Pausar/Sair do modo foco</span>
                    </div>
                </div>
            </div>
        </div>
    </dialog>

    <dialog id="settings-modal" class="modal" aria-labelledby="settings-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="settings-title">Configurações da Sessão</h2>
                <button class="modal-close" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Aparência</h3>
                    <div class="setting-item">
                        <label for="theme-toggle">Tema</label>
                        <div class="toggle-group">
                            <button class="toggle-option active" data-theme="light">
                                <i class="fas fa-sun"></i> Claro
                            </button>
                            <button class="toggle-option" data-theme="dark">
                                <i class="fas fa-moon"></i> Escuro
                            </button>
                            <button class="toggle-option" data-theme="auto">
                                <i class="fas fa-adjust"></i> Auto
                            </button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="font-size">Tamanho da Fonte</label>
                        <input type="range" id="font-size" min="12" max="24" value="16">
                        <span id="font-size-value">16px</span>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Comportamento</h3>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="auto-flip" checked>
                            Virar automaticamente após avaliar
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="show-timer" checked>
                            Mostrar cronômetro
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="sound-effects">
                            Efeitos sonoros
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="vibration">
                            Vibração (mobile)
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Estudo</h3>
                    <div class="setting-item">
                        <label for="review-order">Ordem de Revisão</label>
                        <select id="review-order">
                            <option value="due">Por vencimento</option>
                            <option value="random">Aleatória</option>
                            <option value="difficulty">Por dificuldade</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="show-hints">
                            Mostrar dicas disponíveis
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="reset">Restaurar Padrões</button>
                <button class="btn btn-primary" data-action="save">Salvar</button>
            </div>
        </div>
    </dialog>

    <dialog id="notes-modal" class="modal" aria-labelledby="notes-title">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="notes-title">Adicionar Nota</h2>
                <button class="modal-close" aria-label="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <textarea id="note-content" placeholder="Digite sua nota aqui..." rows="6"></textarea>
                <div class="note-tags">
                    <input type="text" id="note-tags" placeholder="Tags (separadas por vírgula)">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-action="cancel">Cancelar</button>
                <button class="btn btn-primary" data-action="save">
                    <i class="fas fa-save"></i> Salvar Nota
                </button>
            </div>
        </div>
    </dialog>
    <div id="toast-container" class="toast-container" role="status" aria-live="polite"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/api.js"></script>
    <script src="js/study.js"></script>
</body>

</html>